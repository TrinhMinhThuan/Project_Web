<div class="container d-flex flex-column">
  <form id="searchForm"  action="/admin" method="GET">
    <div class="row gap-3">
      <input
        type="text"
        class="col-7 form-control"
        placeholder="T√¨m ki·∫øm b·∫±ng t√™n th·ªÉ lo·∫°i"
        name="keyCategoryName"
        value= "{{ValueName}}"
      />
      <button type="submit" class="col btn btn-success">Tra c·ª©u</button>
    </div>
  </from>

  <div class="query-result mt-5">
    <h5 class="text-center mb-3">K·∫æT QU·∫¢ TRA C·ª®U</h5>
    <table class="table">
      <thead>
        <tr>
          <th scope="col">#ID</th>
          <th scope="col">T√™n th·ªÉ lo·∫°i</th>
          <th scope="col">S·ªë s·∫£n ph·∫©m</th>
          <th scope="col">X√≥a</th>
          <th scope="col">Ch·ªânh s·ª≠a</th>
        </tr>
      </thead>
      <tbody>
         {{#each _Categories}}
          <tr id = {{this.CategoryID}}>
            <th scope="row" >{{this.CategoryID}}</th>
            <td>{{this.CategoryName}}</td>
            <td>{{this.CategoryQuantity}}</td>
            <td>
              <button class="btn-delete" data-category-id="{{this.CategoryID}}">
                <i class="fas fa-trash"></i> 
              </button></td>
             <td>
              <button class="btn-edit" data-category-id="{{this.CategoryID}}">
                <i class="fas fa-edit"></i> 
              </button>
            </td>
          </tr>
        {{else}}
          <td colspan="6" class="text-center">Kh√¥ng T√¨m Th·∫•y S√°ch Theo Y√™u C·∫ßuü•≤</td>
        {{/each}}
      </tbody>
    </table>
  </div>
  <div class="d-flex justify-content-center">
    {{#if pages}}
    <select class="col-2 align-self-center paging form-select">
      {{#each pages}}
      <option value="{{this}}">Page {{this}}</option>
      {{/each}}
    </select>
    {{/if}}
  </div>
</div>
<script>
document.querySelectorAll('.btn-delete').forEach(button => {
  button.addEventListener('click', function() {
    event.preventDefault();
    const categoryId = this.getAttribute('data-category-id');
    const deleteUrl = `/admin/categories/delete/${categoryId}`;
    // S·ª≠ d·ª•ng AJAX ƒë·ªÉ g·ª≠i y√™u c·∫ßu DELETE
    const xhr = new XMLHttpRequest();
    xhr.open('DELETE', deleteUrl, true);

    xhr.onreadystatechange = function() {
      if (xhr.readyState === 4) {
        console.log(xhr.status);
        if (xhr.status === 200) {
          // X·ª≠ l√Ω th√†nh c√¥ng
          updateUI(categoryId);
          console.log('D·ªØ li·ªáu ƒë√£ ƒë∆∞·ª£c x√≥a th√†nh c√¥ng!');
        } else {
          // X·ª≠ l√Ω l·ªói
          console.error('L·ªói x√≥a d·ªØ li·ªáu:', xhr.statusText);
        }
      }
    };
    xhr.send();
  });
});
function updateUI(categoryId) {
    // L·∫•y tham chi·∫øu ƒë·∫øn ph·∫ßn t·ª≠ tr·ª±c ti·∫øp b·∫±ng id
    const rowToRemove = document.getElementById(categoryId);
    // Ki·ªÉm tra xem c√≥ ph·∫ßn t·ª≠ ƒë·ªÉ lo·∫°i b·ªè kh√¥ng
    if (rowToRemove) {
      // Lo·∫°i b·ªè h√†ng t·ª´ DOM
      rowToRemove.remove();
    } else {
      console.error('Kh√¥ng t√¨m th·∫•y h√†ng ƒë·ªÉ lo·∫°i b·ªè.');
    }
}
</script>
