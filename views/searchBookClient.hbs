<div class="container d-flex flex-column">
  <form id="searchForm" >
    <div class="row gap-3">
      <input type="text" id="inputKey" class="col-7 form-control" placeholder="Nh·∫≠p t·ª´ kh√≥a" name="keyword" value="{{keyword}}" />
      <select name="type" class="col-2 form-select option">
        <option value="ProductName">T√™n s√°ch</option>
        <option value="Author">T√°c Gi·∫£</option>
        <option value="CategoryName">Th·ªÉ lo·∫°i</option>
      </select>
      <button type="submit" class="col btn btn-success">Tra c·ª©u</button>
    </div>
  </form>
   <form id="filterForm">
    <div class="row gap-3">
      <p class="col fw-bold mt-2" style="align-items: center;">L·ªçc theo gi√° (VNƒê): </p>
      <input type="number" class="col-3 form-control" placeholder="T·ª´" name="minPrice" value="{{MinPrice}}"
        required />
      <input type="number" class="col-3 form-control" placeholder="ƒê·∫øn" name="maxPrice" value="{{MaxPrice}}"
        required />
      <button type="submit" class="col btn btn-success h-75 justify-content-end" id="applyFilter">
        <i class="fa-solid fa-filter"></i> √Åp d·ª•ng b·ªô l·ªçc</button>
    </div>
  </form>
  <div class="query-result mt-3">
    <h5 class="text-center mb-3 fw-bold">K·∫æT QU·∫¢ TRA C·ª®U</h5>
    <div class="container mt-4">
      <div class="row justify-content-center">
        {{#if _books.length}}
        {{#each _books}}
        <div class="col-md-4 col-lg-3 col-sm-6 mt-4">
          <div class="card text-center">
            <img src="/Images/{{this.Image}}" height="190px" class="card-img-top" alt="·∫¢nh b·ªã h∆∞">
            <div class="card-body" style="Height: 210px">
              <p class="card-title font-weight-bold" style="Height: 30px;">{{this.ProductName}}</p>
              <p class="card-text text-sm mt-4" >S·ªë l∆∞·ª£ng: {{this.StockQuantity}}</p>
              <p class="card-text text-sm">T√°c gi·∫£: {{this.Author}}</p>
              <p class="card-text text-sm">Gi√°: {{this.Price}}</p>
            </div>
            <div class="card-footer">
              <!-- Th√™m n√∫t th√™m v√†o gi·ªè h√†ng -->
              <input type="number" placeholder="Nh·∫≠p s·ªë l∆∞·ª£ng" name="quantity" id="quantityInput{{this.ProductID}}" min="1" value="1" style="text-align: center;" required/>
              <button   type="button" data-product-id="{{this.ProductID}}" class="mt-2 btn-addCart btn btn-danger btn-sm">Th√™m v√†o gi·ªè h√†ng</button>
            </div>
          </div>
        </div>
        {{/each}}
      </div>
      {{else}}
      <p class="text-center">Kh√¥ng T√¨m Th·∫•y S√°ch Theo Y√™u C·∫ßuü•≤</p>
      {{/if}}
    </div>
    <div class="d-flex justify-content-center mt-4 mb-4">
      {{#if pages}}
      <select class="col-2 align-self-center paging form-select">
        {{#each pages}}
        <option value="{{this}}">Page {{this}}</option>
        {{/each}}
      </select>
      {{/if}}
    </div>
  </div>
  <style>
    .card:hover {
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
      transform: scale(1.05);
      cursor: pointer;
      /* S·ª≠ d·ª•ng con tr·ªè pointer khi r√™ v√†o */
    }
  </style>
</div>
<script>
  // Update Page
  const selection = document.querySelector(".paging");
  selection?.addEventListener("change", (e) => {
    const url = new URL(window.location.href);
    const query = new URLSearchParams(window.location.search);
    query.set("page", e.target.value);
    url.search = query;
    location.assign(url.href);
  });
  const query = new URLSearchParams(window.location.search);
  if (selection) selection.value = query.get("page") || 1;
  
  document.querySelector(".option").value = query.get("type") || "ProductName"

  // Add cart
  document.querySelectorAll('.btn-addCart').forEach(button => {
    button.addEventListener('click', function() {
      event.preventDefault();

      const productID = this.getAttribute('data-product-id');

      var quantityValue = document.getElementById(`quantityInput${productID}`).value;
      const url = new URL(`/cartBook/addCart/${productID}`,window.location.href);
      const query = new URLSearchParams(window.location.search);
      query.set("quantity", quantityValue);
      url.search = query;
      location.assign(url.href);
    });
  });

  document.getElementById("filterForm").addEventListener("submit", function (event) {
    event.preventDefault(); // NgƒÉn ch·∫∑n form submit m·∫∑c ƒë·ªãnh ƒë·ªÉ x·ª≠ l√Ω b·∫±ng JavaScript

    var minValue = document.getElementsByName("minPrice")[0].value;
    var maxValue = document.getElementsByName("maxPrice")[0].value;

    // T·∫°o URL v·ªõi tham s·ªë
    var url = new URL(window.location.href);
    var query = new URLSearchParams(url.search);
    query.set("minPrice", minValue);
    query.set("maxPrice", maxValue);
    url.search = query.toString();

    // Chuy·ªÉn h∆∞·ªõng trang
    window.location.href = "/cartBook/addCart/";
  });

  document.getElementById("searchForm").addEventListener("submit", function (event) {
    event.preventDefault(); // NgƒÉn ch·∫∑n form submit m·∫∑c ƒë·ªãnh ƒë·ªÉ x·ª≠ l√Ω b·∫±ng JavaScript

    // L·∫•y gi√° tr·ªã t·ª´ input v√† select
    var keywordValue = document.getElementsByName("keyword")[0].value;
    var typeValue = document.getElementsByName("type")[0].value;

    // T·∫°o URL v·ªõi tham s·ªë
    var url = new URL(window.location.href);
    var query = new URLSearchParams(url.search);
    query.set("keyword", keywordValue);
    query.set("type", typeValue);
    url.search = query.toString();

    // Chuy·ªÉn h∆∞·ªõng trang
    location.assign(url.href);
  });
</script>